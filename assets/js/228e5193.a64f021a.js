"use strict";(self.webpackChunkpike_cookbook=self.webpackChunkpike_cookbook||[]).push([[184],{2913(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"files/directories","title":"Directories","description":"Introduction","source":"@site/docs/files/directories.md","sourceDirName":"files","slug":"/files/directories","permalink":"/pike-cookbook/docs/files/directories","draft":false,"unlisted":false,"editUrl":"https://github.com/TheSmuks/pike-cookbook/tree/main/docs/files/directories.md","tags":[],"version":"current","frontMatter":{"id":"directories","title":"Directories","sidebar_label":"Directories"},"sidebar":"tutorialSidebar","previous":{"title":"File Contents","permalink":"/pike-cookbook/docs/files/file-contents"},"next":{"title":"Database Access","permalink":"/pike-cookbook/docs/files/database-access"}}');var r=i(4848),s=i(8453);const a={id:"directories",title:"Directories",sidebar_label:"Directories"},l="Directories",o={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Reading Directory Contents",id:"reading-directory-contents",level:2},{value:"List All Files",id:"list-all-files",level:3},{value:"Filter Files by Type",id:"filter-files-by-type",level:3},{value:"Recursive Directory Listing",id:"recursive-directory-listing",level:3},{value:"Creating Directories",id:"creating-directories",level:2},{value:"Create Single Directory",id:"create-single-directory",level:3},{value:"Create Nested Directories",id:"create-nested-directories",level:3},{value:"Removing Directories",id:"removing-directories",level:2},{value:"Remove Empty Directory",id:"remove-empty-directory",level:3},{value:"Remove Directory and Contents",id:"remove-directory-and-contents",level:3},{value:"Changing Directories",id:"changing-directories",level:2},{value:"Current Working Directory",id:"current-working-directory",level:3},{value:"Operations in Different Directory",id:"operations-in-different-directory",level:3},{value:"Directory Information",id:"directory-information",level:2},{value:"Get Directory Size",id:"get-directory-size",level:3},{value:"Find Largest Files",id:"find-largest-files",level:3},{value:"Directory Patterns",id:"directory-patterns",level:2},{value:"Find Files Matching Pattern",id:"find-files-matching-pattern",level:3},{value:"Directory Watcher",id:"directory-watcher",level:3},{value:"Practical Examples",id:"practical-examples",level:2},{value:"Clean Temporary Files",id:"clean-temporary-files",level:3},{value:"Organize Files by Extension",id:"organize-files-by-extension",level:3},{value:"Backup Directory",id:"backup-directory",level:3},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"directories",children:"Directories"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"Working with directories is essential for file system operations. Pike provides comprehensive tools for directory traversal, creation, and manipulation."}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Always check if a directory exists before operations using ",(0,r.jsx)(n.code,{children:"file_stat()"})," or ",(0,r.jsx)(n.code,{children:"Stdio.is_dir()"}),"."]})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"reading-directory-contents",children:"Reading Directory Contents"}),"\n",(0,r.jsx)(n.h3,{id:"list-all-files",children:"List All Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: List directory contents\n//-----------------------------\n\n// Method 1: Using get_dir()\narray(string) files = get_dir("/path/to/directory");\n\nif (files) {\n    write("Found %d items:\\n", sizeof(files));\n    foreach(files;; string filename) {\n        write("  - %s\\n", filename);\n    }\n} else {\n    werror("Directory not found or not readable\\n");\n}\n\n// Method 2: Using file system object\nStdio.File dir = Stdio.File("/path/to/directory");\n\nif (dir) {\n    array(string) contents = dir->get_dir();\n    foreach(contents;; string item) {\n        write("%s\\n", item);\n    }\n    dir->close();\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"filter-files-by-type",children:"Filter Files by Type"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: List only files or directories\n//-----------------------------\n\nstring path = "/path/to/directory";\narray(string) all_items = get_dir(path) || ({});\n\narray(string) files = ({});\narray(string) directories = ({});\n\nforeach(all_items;; string item) {\n    string full_path = combine_path(path, item);\n    object stat = file_stat(full_path);\n\n    if (!stat) continue;\n\n    if (stat->isdir) {\n        directories += ({item});\n    } else if (stat->isreg) {\n        files += ({item});\n    }\n}\n\nwrite("Directories:\\n");\nforeach(directories;; string d) {\n    write("  [DIR] %s\\n", d);\n}\n\nwrite("Files:\\n");\nforeach(files;; string f) {\n    write("  [FILE] %s\\n", f);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"recursive-directory-listing",children:"Recursive Directory Listing"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: List all files recursively\n//-----------------------------\n\narray(string) list_files_recursive(string path, void|bool include_hidden) {\n    array(string) result = ({});\n    array(string) items = get_dir(path);\n\n    if (!items) return result;\n\n    foreach(items;; string item) {\n        // Skip hidden files (starting with .)\n        if (!include_hidden && has_prefix(item, "."))\n            continue;\n\n        string full_path = combine_path(path, item);\n        object stat = file_stat(full_path);\n\n        if (!stat) continue;\n\n        // Add to result\n        result += ({full_path});\n\n        // Recurse into subdirectories\n        if (stat->isdir) {\n            result += list_files_recursive(full_path, include_hidden);\n        }\n    }\n\n    return result;\n}\n\n// Usage\narray(string) all_files = list_files_recursive("/home/user/documents");\nwrite("Found %d files:\\n", sizeof(all_files));\nforeach(all_files;; string f) {\n    write("  %s\\n", f);\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"creating-directories",children:"Creating Directories"}),"\n",(0,r.jsx)(n.h3,{id:"create-single-directory",children:"Create Single Directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Create a directory\n//-----------------------------\n\nstring dir_path = "/tmp/new_directory";\n\n// Check if exists\nif (file_stat(dir_path)) {\n    werror("Directory already exists\\n");\n} else {\n    // Create directory\n    if (mkdir(dir_path)) {\n        write("Created directory: %s\\n", dir_path);\n    } else {\n        werror("Failed to create directory: %s\\n", strerror(errno()));\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"create-nested-directories",children:"Create Nested Directories"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Create directory with parents\n//-----------------------------\n\n// Pike doesn\'t have mkdir -p built-in, so create recursively\nbool mkdir_p(string path) {\n    // Check if already exists\n    object stat = file_stat(path);\n    if (stat && stat->isdir) {\n        return true;\n    }\n\n    // Create parent directories first\n    string parent = dirname(path);\n    if (sizeof(parent) && parent != path) {\n        if (!mkdir_p(parent)) {\n            return false;\n        }\n    }\n\n    // Create this directory\n    if (mkdir(path)) {\n        return true;\n    }\n\n    // Check if it was created by another process\n    stat = file_stat(path);\n    return (stat && stat->isdir);\n}\n\n// Usage\nstring deep_path = "/tmp/level1/level2/level3";\nif (mkdir_p(deep_path)) {\n    write("Created: %s\\n", deep_path);\n} else {\n    werror("Failed to create: %s\\n", deep_path);\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"removing-directories",children:"Removing Directories"}),"\n",(0,r.jsx)(n.h3,{id:"remove-empty-directory",children:"Remove Empty Directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Remove empty directory\n//-----------------------------\n\nstring dir_path = "/tmp/empty_dir";\n\n// Check if directory is empty\narray(string) contents = get_dir(dir_path);\nif (contents && sizeof(contents) == 0) {\n    if (rm(dir_path)) {\n        write("Removed empty directory\\n");\n    } else {\n        werror("Failed to remove: %s\\n", strerror(errno()));\n    }\n} else {\n    werror("Directory not empty\\n");\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"remove-directory-and-contents",children:"Remove Directory and Contents"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Remove directory recursively\n//-----------------------------\n\nbool remove_recursive(string path) {\n    object stat = file_stat(path);\n\n    if (!stat) {\n        // Already gone\n        return true;\n    }\n\n    if (stat->isreg) {\n        // Remove file\n        return rm(path);\n    }\n\n    if (stat->isdir) {\n        // Remove contents first\n        array(string) items = get_dir(path);\n        if (items) {\n            foreach(items;; string item) {\n                string full_path = combine_path(path, item);\n                if (!remove_recursive(full_path)) {\n                    return false;\n                }\n            }\n        }\n\n        // Remove empty directory\n        return rm(path);\n    }\n\n    return false;\n}\n\n// Usage\nif (remove_recursive("/tmp/mydata")) {\n    write("Removed directory tree\\n");\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Be very careful with recursive deletion! Always verify the path before calling ",(0,r.jsx)(n.code,{children:"remove_recursive()"}),"."]})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"changing-directories",children:"Changing Directories"}),"\n",(0,r.jsx)(n.h3,{id:"current-working-directory",children:"Current Working Directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Get and change current directory\n//-----------------------------\n\n// Get current directory\nstring cwd = getcwd();\nwrite("Current directory: %s\\n", cwd);\n\n// Change directory\nif (cd("/tmp")) {\n    write("Changed to: %s\\n", getcwd());\n} else {\n    werror("Failed to change directory\\n");\n}\n\n// Execute in directory\ncd("/home/user");\narray(string) files = get_dir(".");\nwrite("Files in home: %s\\n", files * ", ");\n'})}),"\n",(0,r.jsx)(n.h3,{id:"operations-in-different-directory",children:"Operations in Different Directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Work with files in other directories\n//-----------------------------\n\n// Read file from another directory\nstring content = Stdio.read_file("/path/to/file.txt");\n\n// Better: use combine_path for portability\nstring base_dir = "/path/to";\nstring filename = "file.txt";\nstring full_path = combine_path(base_dir, filename);\ncontent = Stdio.read_file(full_path);\n\n// Relative paths work too\nstring config = Stdio.read_file("../config/settings.ini");\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"directory-information",children:"Directory Information"}),"\n",(0,r.jsx)(n.h3,{id:"get-directory-size",children:"Get Directory Size"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Calculate directory size\n//-----------------------------\n\nint get_directory_size(string path) {\n    int total_size = 0;\n    array(string) items = get_dir(path);\n\n    if (!items) return 0;\n\n    foreach(items;; string item) {\n        string full_path = combine_path(path, item);\n        object stat = file_stat(full_path);\n\n        if (!stat) continue;\n\n        if (stat->isreg) {\n            total_size += stat->size;\n        } else if (stat->isdir) {\n            total_size += get_directory_size(full_path);\n        }\n    }\n\n    return total_size;\n}\n\n// Format size nicely\nstring format_size(int bytes) {\n    if (bytes < 1024) return bytes + " B";\n    if (bytes < 1024 * 1024) return sprintf("%.1f KB", bytes / 1024.0);\n    if (bytes < 1024 * 1024 * 1024) return sprintf("%.1f MB", bytes / (1024.0 * 1024));\n    return sprintf("%.1f GB", bytes / (1024.0 * 1024 * 1024));\n}\n\n// Usage\nint size = get_directory_size("/home/user/documents");\nwrite("Directory size: %s\\n", format_size(size));\n'})}),"\n",(0,r.jsx)(n.h3,{id:"find-largest-files",children:"Find Largest Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Find largest files in directory tree\n//-----------------------------\n\narray(mapping) find_largest_files(string path, int top_n) {\n    mapping(string:int) file_sizes = ([]);\n\n    // Collect all files\n    array(string) all_files = list_files_recursive(path);\n\n    foreach(all_files;; string filepath) {\n        object stat = file_stat(filepath);\n        if (stat && stat->isreg) {\n            file_sizes[filepath] = stat->size;\n        }\n    }\n\n    // Sort by size\n    array(string) sorted = indices(file_sizes);\n    sort(file_sizes[*], sorted);\n    sorted = reverse(sorted);\n\n    // Get top N\n    array(mapping) result = ({});\n    foreach(sorted[0..top_n-1];; string filepath) {\n        result += ({([\n            "path": filepath,\n            "size": file_sizes[filepath],\n            "formatted": format_size(file_sizes[filepath])\n        ])});\n    }\n\n    return result;\n}\n\n// Usage\narray(mapping) largest = find_largest_files("/home/user", 10);\nwrite("Largest files:\\n");\nforeach(largest;; mapping info) {\n    write("  %s: %s\\n", info->formatted, info->path);\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"directory-patterns",children:"Directory Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"find-files-matching-pattern",children:"Find Files Matching Pattern"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Find files by pattern\n//-----------------------------\n\narray(string) find_files_by_pattern(string path, string pattern) {\n    array(string) result = ({});\n    array(string) items = get_dir(path);\n\n    if (!items) return result;\n\n    // Create regex from glob pattern\n    string regex = replace(pattern, ({"*", "."}), ({"[^/]*", "\\\\."}));\n    object re = Regexp.PCRE.Simple("^" + regex + "$");\n\n    foreach(items;; string item) {\n        if (re->match(item)) {\n            result += ({combine_path(path, item)});\n        }\n    }\n\n    return result;\n}\n\n// Usage\narray(string) pike_files = find_files_by_pattern("/home/user/code", "*.pike");\nwrite("Pike files:\\n");\nforeach(pike_files;; string f) {\n    write("  %s\\n", f);\n}\n\n// Find log files\narray(string) logs = find_files_by_pattern("/var/log", "*.log");\n'})}),"\n",(0,r.jsx)(n.h3,{id:"directory-watcher",children:"Directory Watcher"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Monitor directory for changes\n//-----------------------------\n\nmapping(string:int) get_directory_state(string path) {\n    mapping(string:int) state = ([]);\n    array(string) items = get_dir(path);\n\n    if (!items) return state;\n\n    foreach(items;; string item) {\n        string full_path = combine_path(path, item);\n        object stat = file_stat(full_path);\n\n        if (stat) {\n            state[full_path] = stat->mtime;\n        }\n    }\n\n    return state;\n}\n\nvoid watch_directory(string path, int interval_seconds) {\n    write("Watching: %s\\n", path);\n\n    mapping(string:int) last_state = get_directory_state(path);\n\n    while (1) {\n        sleep(interval_seconds);\n\n        mapping(string:int) current_state = get_directory_state(path);\n\n        // Check for new files\n        foreach(indices(current_state);; string file) {\n            if (!last_state[file]) {\n                write("NEW: %s\\n", file);\n            } else if (current_state[file] > last_state[file]) {\n                write("MODIFIED: %s\\n", file);\n            }\n        }\n\n        // Check for deleted files\n        foreach(indices(last_state);; string file) {\n            if (!current_state[file]) {\n                write("DELETED: %s\\n", file);\n            }\n        }\n\n        last_state = current_state;\n    }\n}\n\n// Usage (in a separate thread or background)\n// watch_directory("/home/user/watch", 5);\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"practical-examples",children:"Practical Examples"}),"\n",(0,r.jsx)(n.h3,{id:"clean-temporary-files",children:"Clean Temporary Files"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Remove files older than N days\n//-----------------------------\n\nvoid cleanup_old_files(string path, int max_age_days) {\n    int cutoff_time = time() - (max_age_days * 24 * 60 * 60);\n    int deleted_count = 0;\n    int freed_space = 0;\n\n    array(string) files = list_files_recursive(path);\n\n    foreach(files;; string filepath) {\n        object stat = file_stat(filepath);\n\n        if (stat && stat->isreg && stat->mtime < cutoff_time) {\n            int size = stat->size;\n\n            if (rm(filepath)) {\n                deleted_count++;\n                freed_space += size;\n                write("Deleted: %s (%s)\\n",\n                      filepath, format_size(size));\n            }\n        }\n    }\n\n    write("\\nSummary:\\n");\n    write("  Deleted: %d files\\n", deleted_count);\n    write("  Freed: %s\\n", format_size(freed_space));\n}\n\n// Usage: Delete files older than 30 days\n// cleanup_old_files("/tmp/cache", 30);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"organize-files-by-extension",children:"Organize Files by Extension"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Sort files into subdirectories\n//-----------------------------\n\nvoid organize_by_extension(string source_dir) {\n    array(string) files = get_dir(source_dir) || ({});\n\n    foreach(files;; string filename) {\n        string full_path = combine_path(source_dir, filename);\n        object stat = file_stat(full_path);\n\n        if (!stat || !stat->isreg) continue;\n\n        // Get extension\n        array(string) parts = filename / ".";\n        string ext = sizeof(parts) > 1 ? parts[-1] : "no_ext";\n\n        // Create target directory\n        string target_dir = combine_path(source_dir, ext);\n        mkdir_p(target_dir);\n\n        // Move file\n        string target_path = combine_path(target_dir, filename);\n\n        if (rename(full_path, target_path)) {\n            write("Moved: %s -> %s/\\n", filename, ext);\n        }\n    }\n}\n\n// Usage\n// organize_by_extension("/home/user/Downloads");\n'})}),"\n",(0,r.jsx)(n.h3,{id:"backup-directory",children:"Backup Directory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-pike",children:'//-----------------------------\n// Recipe: Create timestamped backup\n//-----------------------------\n\nstring backup_directory(string source_dir, string backup_root) {\n    // Create backup name with timestamp\n    string timestamp = Calendar.ISO.now()->format_nice();\n    timestamp = replace(timestamp, " ", "_");\n    timestamp = replace(timestamp, ":", "-");\n\n    string backup_name = basename(source_dir) + "_backup_" + timestamp;\n    string backup_path = combine_path(backup_root, backup_name);\n\n    write("Creating backup: %s\\n", backup_path);\n\n    // Copy directory recursively\n    array(string) items = get_dir(source_dir);\n    if (!items) {\n        werror("Source directory not found\\n");\n        return "";\n    }\n\n    mkdir_p(backup_path);\n\n    foreach(items;; string item) {\n        string src = combine_path(source_dir, item);\n        string dst = combine_path(backup_path, item);\n\n        object stat = file_stat(src);\n        if (!stat) continue;\n\n        if (stat->isreg) {\n            // Copy file\n            string content = Stdio.read_file(src);\n            if (content) {\n                Stdio.write_file(dst, content);\n            }\n        } else if (stat->isdir) {\n            // Recurse into subdirectory\n            backup_directory(src, backup_path);\n        }\n    }\n\n    return backup_path;\n}\n\n// Usage\n// string backup = backup_directory("/home/user/documents", "/backups");\n// write("Backup created at: %s\\n", backup);\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/files/file-access",children:"File Access"})," - Working with individual files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/files/file-contents",children:"File Contents"})," - Reading and writing file data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/files/database-access",children:"Database Access"})," - Database operations"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>l});var t=i(6540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);