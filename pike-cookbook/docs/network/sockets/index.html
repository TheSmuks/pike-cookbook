<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-network/sockets" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Sockets | Pike Cookbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://TheSmuks.github.io/pike-cookbook/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://TheSmuks.github.io/pike-cookbook/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://TheSmuks.github.io/pike-cookbook/docs/network/sockets"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Sockets | Pike Cookbook"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/pike-cookbook/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://TheSmuks.github.io/pike-cookbook/docs/network/sockets"><link data-rh="true" rel="alternate" href="https://TheSmuks.github.io/pike-cookbook/docs/network/sockets" hreflang="en"><link data-rh="true" rel="alternate" href="https://TheSmuks.github.io/pike-cookbook/docs/network/sockets" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Sockets","item":"https://TheSmuks.github.io/pike-cookbook/docs/network/sockets"}]}</script><link rel="stylesheet" href="/pike-cookbook/assets/css/styles.7a9da498.css">
<script src="/pike-cookbook/assets/js/runtime~main.640ae0d4.js" defer="defer"></script>
<script src="/pike-cookbook/assets/js/main.c3b68af9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pike-cookbook/"><div class="navbar__logo"><img src="/pike-cookbook/img/logo.svg" alt="Pike Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pike-cookbook/img/logo.svg" alt="Pike Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Pike Cookbook</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pike-cookbook/docs/intro">Cookbook</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/smuks/pike-cookbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pike-cookbook/docs/intro"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/pike-cookbook/docs/basics/strings"><span title="Basic Recipes" class="categoryLinkLabel_W154">Basic Recipes</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/strings"><span title="Strings" class="linkLabel_WmDU">Strings</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/numbers"><span title="Numbers" class="linkLabel_WmDU">Numbers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/arrays"><span title="Arrays" class="linkLabel_WmDU">Arrays</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/hashes"><span title="Hashes" class="linkLabel_WmDU">Hashes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/dates"><span title="Dates and Times" class="linkLabel_WmDU">Dates and Times</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/pattern-matching"><span title="Pattern Matching" class="linkLabel_WmDU">Pattern Matching</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/basics/subroutines"><span title="Subroutines" class="linkLabel_WmDU">Subroutines</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/pike-cookbook/docs/files/file-access"><span title="File Operations" class="categoryLinkLabel_W154">File Operations</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/files/file-access"><span title="File Access" class="linkLabel_WmDU">File Access</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/files/file-contents"><span title="File Contents" class="linkLabel_WmDU">File Contents</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/files/directories"><span title="Directories" class="linkLabel_WmDU">Directories</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/files/database-access"><span title="Database Access" class="linkLabel_WmDU">Database Access</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/pike-cookbook/docs/network/cgi-programming"><span title="Network &amp; Web" class="categoryLinkLabel_W154">Network &amp; Web</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/network/cgi-programming"><span title="CGI Programming" class="linkLabel_WmDU">CGI Programming</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pike-cookbook/docs/network/sockets"><span title="Sockets" class="linkLabel_WmDU">Sockets</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/network/web-automation"><span title="Web Automation" class="linkLabel_WmDU">Web Automation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/network/internet-services"><span title="Internet Services" class="linkLabel_WmDU">Internet Services</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/pike-cookbook/docs/advanced/classes"><span title="Advanced Topics" class="categoryLinkLabel_W154">Advanced Topics</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/advanced/classes"><span title="Classes and Objects" class="linkLabel_WmDU">Classes and Objects</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/advanced/references"><span title="References and Records" class="linkLabel_WmDU">References and Records</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/advanced/modules"><span title="Modules and Packages" class="linkLabel_WmDU">Modules and Packages</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/advanced/processes"><span title="Process Management" class="linkLabel_WmDU">Process Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pike-cookbook/docs/advanced/user-interfaces"><span title="User Interfaces" class="linkLabel_WmDU">User Interfaces</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pike-cookbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Network &amp; Web</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Sockets</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>17. Sockets</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Pike doesn&#x27;t normally use packed IP addresses. Strings such as &quot;204.148.40.9&quot; are used literally.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//DNS lookups can be done with gethostbyname() and gethostbyaddr()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[string host,array ip,array alias] = gethostbyname(&quot;www.example.com&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//ip[0] is a string &quot;192.0.32.10&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="writing-a-tcp-client">Writing a TCP Client<a href="#writing-a-tcp-client" class="hash-link" aria-label="Direct link to Writing a TCP Client" title="Direct link to Writing a TCP Client" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.File sock=Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if (!sock-&gt;connect(remote_host,remote_port)) //Connection failed. Error code is in sock-&gt;errno().</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    werror(&quot;Couldn&#x27;t connect to %s:%d: %s\n&quot;,remote_host,remote_port,strerror(sock-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;write(&quot;Hello, world!&quot;); //Send something to the socket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">string answer=sock-&gt;read(); //Read until the remote side disconnects. Use sock-&gt;read(1024,1) to read only some (up to 1KB here).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;close(); //Not necessary if the sock object goes out of scope here.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="writing-a-tcp-server">Writing a TCP Server<a href="#writing-a-tcp-server" class="hash-link" aria-label="Direct link to Writing a TCP Server" title="Direct link to Writing a TCP Server" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.Port mainsock=Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if (!mainsock-&gt;bind(server_port))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    werror(&quot;Couldn&#x27;t be a tcp server on port %d: %s\n&quot;,server_port,strerror(mainsock-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while (1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File sock=mainsock-&gt;accept();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!sock) break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //sock is the new connection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //if you don&#x27;t do anything and just let sock expire, the client connection will be closed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="communicating-over-tcp">Communicating over TCP<a href="#communicating-over-tcp" class="hash-link" aria-label="Direct link to Communicating over TCP" title="Direct link to Communicating over TCP" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;write(&quot;What is your name?\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">string response=sock-&gt;read(1024,1); //Reads up to 1KB or whatever is available (minimum 1 byte).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Buffered reads:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.FILE sock2=Stdio.FILE(); sock2-&gt;assign(sock);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">string response=sock2-&gt;gets();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-up-a-udp-client">Setting Up a UDP Client<a href="#setting-up-a-udp-client" class="hash-link" aria-label="Direct link to Setting Up a UDP Client" title="Direct link to Setting Up a UDP Client" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// UDP Client (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.UDP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (argc &lt; 3) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Usage: %s host port [message]\n&quot;, argv[0]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string host = argv[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int port = (int)argv[2];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string msg = argc &gt; 3 ? argv[3] : &quot;Hello, UDP!&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create UDP socket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.UDP udp = Stdio.UDP();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!udp) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Failed to create UDP socket: %s\n&quot;, strerror(errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Send datagram</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    udp-&gt;send(host, port, msg);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;Sent &#x27;%s&#x27; to %s:%d\n&quot;, msg, host, port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Wait for response (with timeout)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mixed response = udp-&gt;read(1024, &quot;.&quot;, 5.0);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (response) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string data = response[0];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string from = response[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;Received &#x27;%s&#x27; from %s\n&quot;, data, from);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;No response (timeout)\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    udp-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-up-a-udp-server">Setting Up a UDP Server<a href="#setting-up-a-udp-server" class="hash-link" aria-label="Direct link to Setting Up a UDP Server" title="Direct link to Setting Up a UDP Server" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// UDP Server (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.UDP)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int port = argc &gt; 1 ? (int)argv[1] : 8080;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create and bind UDP socket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.UDP udp = Stdio.UDP();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!udp-&gt;bind(port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Failed to bind to port %d: %s\n&quot;, port, strerror(udp-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;UDP server listening on port %d\n&quot;, port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Enable broadcast</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    udp-&gt;set_option(Stdio.PORT_BROADCAST, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Read datagram</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mixed data = udp-&gt;read();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!data) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            werror(&quot;Read error: %s\n&quot;, strerror(udp-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string msg = data[0];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string from = data[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;Received &#x27;%s&#x27; from %s\n&quot;, msg, from);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Send echo response</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        array addr = from / &quot; &quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        udp-&gt;send(addr[0], (int)addr[1], &quot;Echo: &quot; + msg);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    udp-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-unix-domain-sockets">Using UNIX Domain Sockets<a href="#using-unix-domain-sockets" class="hash-link" aria-label="Direct link to Using UNIX Domain Sockets" title="Direct link to Using UNIX Domain Sockets" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// UNIX Domain Socket Client (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string socket_path = argc &gt; 1 ? argv[1] : &quot;/tmp/mysocket&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File sock = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!sock-&gt;connect(socket_path)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Couldn&#x27;t connect to %s: %s\n&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              socket_path, strerror(sock-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sock-&gt;write(&quot;Hello via UNIX socket!\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string response = sock-&gt;read();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;Server response: %s\n&quot;, response);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sock-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="unix-domain-socket-server">UNIX Domain Socket Server<a href="#unix-domain-socket-server" class="hash-link" aria-label="Direct link to UNIX Domain Socket Server" title="Direct link to UNIX Domain Socket Server" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// UNIX Domain Socket Server (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.Port)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string socket_path = argc &gt; 1 ? argv[1] : &quot;/tmp/mysocket&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Remove old socket file if exists</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (file_stat(socket_path)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        rm(socket_path);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.Port port = Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!port-&gt;bind(socket_path)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Couldn&#x27;t bind to %s: %s\n&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              socket_path, strerror(port-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;UNIX domain socket server listening on %s\n&quot;, socket_path);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Stdio.File sock = port-&gt;accept();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!sock) continue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string data = sock-&gt;read(1024, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (data) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            write(&quot;Received: %s\n&quot;, data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sock-&gt;write(&quot;Acknowledged\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sock-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Cleanup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    port-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rm(socket_path);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="identifying-the-other-end-of-a-socket">Identifying the Other End of a Socket<a href="#identifying-the-other-end-of-a-socket" class="hash-link" aria-label="Direct link to Identifying the Other End of a Socket" title="Direct link to Identifying the Other End of a Socket" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">string other_end=sock-&gt;query_address(); //eg &quot;10.1.1.1 123&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="finding-your-own-name-and-address">Finding Your Own Name and Address<a href="#finding-your-own-name-and-address" class="hash-link" aria-label="Direct link to Finding Your Own Name and Address" title="Direct link to Finding Your Own Name and Address" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Finding Your Own Address (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Get local address of a socket</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">string local_addr = sock-&gt;query_address(1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">write(&quot;Local address: %s\n&quot;, local_addr);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Get hostname and local IP addresses</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">string hostname = gethostname();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">write(&quot;Hostname: %s\n&quot;, hostname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[string host, array ips, array aliases] = gethostbyname(hostname);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">foreach(ips, string ip) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;Local IP: %s\n&quot;, ip);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssltls-sockets">SSL/TLS Sockets<a href="#ssltls-sockets" class="hash-link" aria-label="Direct link to SSL/TLS Sockets" title="Direct link to SSL/TLS Sockets" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// SSL/TLS Client (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(SSL.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(SSL.Context)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (argc &lt; 3) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Usage: %s host port\n&quot;, argv[0]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string host = argv[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int port = (int)argv[2];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create SSL context</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SSL.Context ctx = SSL.Context();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Connect to server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File sock = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!sock-&gt;connect(host, port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Connection failed: %s\n&quot;, strerror(sock-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create SSL connection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SSL.File ssl = SSL.File(sock, ctx);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int result = ssl-&gt;connect();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (result &lt; 0) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;SSL handshake failed\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Send HTTPS request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssl-&gt;write(&quot;GET / HTTP/1.0\r\nHost: &quot; + host + &quot;\r\n\r\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Read response</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string response = ssl-&gt;read();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;%s\n&quot;, response);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssl-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssltls-server">SSL/TLS Server<a href="#ssltls-server" class="hash-link" aria-label="Direct link to SSL/TLS Server" title="Direct link to SSL/TLS Server" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// SSL/TLS Server (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(SSL.Port)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(SSL.Context)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">void handle_ssl_client(SSL.File ssl)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string data = ssl-&gt;read(4096, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (data) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;Received: %s\n&quot;, data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ssl-&gt;write(&quot;HTTP/1.0 200 OK\r\n\r\nSSL Connection Successful!\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ssl-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int port = argc &gt; 1 ? (int)argv[1] : 8443;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string cert_file = &quot;server.pem&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string key_file = &quot;server.key&quot;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create SSL context with certificates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SSL.Context ctx = SSL.Context();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (file_stat(cert_file)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ctx-&gt;certificates = (([{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;cert_file&quot;: cert_file,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;key_file&quot;: key_file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }]));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create SSL port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SSL.Port ssl_port = SSL.Port(ctx);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!ssl_port-&gt;bind(port, handle_ssl_client)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Failed to bind SSL port: %s\n&quot;, strerror(ssl_port-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;SSL server listening on port %d\n&quot;, port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Keep server running</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sleep(1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="closing-a-socket-after-forking">Closing a Socket After Forking<a href="#closing-a-socket-after-forking" class="hash-link" aria-label="Direct link to Closing a Socket After Forking" title="Direct link to Closing a Socket After Forking" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;close(&quot;r&quot;);   //Close the read direction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;close(&quot;w&quot;);   //Close the write direction</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;close(&quot;rw&quot;);  //Shut down both directions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;close();      //Close completely</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="writing-bidirectional-clients">Writing Bidirectional Clients<a href="#writing-bidirectional-clients" class="hash-link" aria-label="Direct link to Writing Bidirectional Clients" title="Direct link to Writing Bidirectional Clients" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Bidirectional Client (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">void read_from_server(Stdio.File sock)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string data = sock-&gt;read(1024, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!data || !sizeof(data)) break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;Server: %s\n&quot;, data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sock-&gt;close(&quot;r&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (argc &lt; 3) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Usage: %s host port\n&quot;, argv[0]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File sock = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!sock-&gt;connect(argv[1], (int)argv[2])) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Connection failed\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Start thread to read from server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.Thread create_thread = Thread.Thread(read_from_server, sock);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Read from stdin and send to server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (string line = Stdio.stdin-&gt;gets()) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sock-&gt;write(line + &quot;\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sock-&gt;close(&quot;w&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    create_thread-&gt;wait();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="non-blocking-io-with-select">Non-Blocking I/O with select()<a href="#non-blocking-io-with-select" class="hash-link" aria-label="Direct link to Non-Blocking I/O with select()" title="Direct link to Non-Blocking I/O with select()" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Non-blocking I/O with select() (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int port = argc &gt; 1 ? (int)argv[1] : 8080;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.Port listen_sock = Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!listen_sock-&gt;bind(port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Bind failed: %s\n&quot;, strerror(listen_sock-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    array(Stdio.File) clients = (({}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;Multiplexed server on port %d\n&quot;, port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Build read set</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        array read_fds = clients + (({listen_sock}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Wait for activity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mixed ready = Stdio.select(read_fds);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!ready || !sizeof(ready[0])) continue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Check for new connections</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (has_value(ready[0], listen_sock)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Stdio.File new_client = listen_sock-&gt;accept();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (new_client) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                clients += (({new_client}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                write(&quot;New client: %s\n&quot;, new_client-&gt;query_address());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Check clients for data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        foreach(clients, int i, Stdio.File client) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (has_value(ready[0], client)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                string data = client-&gt;read(1024, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                if (!data || !sizeof(data)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    //Client disconnected</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    write(&quot;Client disconnected\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    client-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    clients = clients[..i-1] + clients[i+1..];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    write(&quot;Received: %s\n&quot;, data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    client-&gt;write(&quot;Echo: &quot; + data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="forking-servers">Forking Servers<a href="#forking-servers" class="hash-link" aria-label="Direct link to Forking Servers" title="Direct link to Forking Servers" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Forking is generally unnecessary in Pike, as the driver works more efficiently with other models.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="socket-options-and-configuration">Socket Options and Configuration<a href="#socket-options-and-configuration" class="hash-link" aria-label="Direct link to Socket Options and Configuration" title="Direct link to Socket Options and Configuration" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Socket Options and Configuration (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Creating a socket with options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.Port port = Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Set SO_REUSEADDR to allow quick restart</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port-&gt;set_option(Stdio.PORT_REUSE_ADDRESS, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Set SO_KEEPALIVE for connection monitoring</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.File sock = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;set_option(Stdio.KEEPALIVE, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Set TCP_NODELAY to disable Nagle&#x27;s algorithm (for real-time apps)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;set_option(Stdio.NO_DELAY, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Set socket buffer sizes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;set_buffer(65536, 65536); //read_buf, write_buf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Set socket timeout</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sock-&gt;set_nonblocking(1, 0, 0); //nonblocking mode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Enable broadcast for UDP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.UDP udp = Stdio.UDP();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">udp-&gt;set_option(Stdio.PORT_BROADCAST, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">udp-&gt;set_option(Stdio.MULTICAST, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Bind to specific interface</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port-&gt;bind(8080, 0, &quot;127.0.0.1&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="modern-async-with-concurrentfuture">Modern Async with Concurrent.Future<a href="#modern-async-with-concurrentfuture" class="hash-link" aria-label="Direct link to Modern Async with Concurrent.Future" title="Direct link to Modern Async with Concurrent.Future" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Modern async socket I/O with Concurrent.Future (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Concurrent.Future)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Async HTTP GET using Future</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Concurrent.Future async_http_get(string host, int port)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Concurrent.Promise result = Concurrent.Promise();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    thread_create(lambda() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Stdio.File sock = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!sock-&gt;connect(host, port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            result-&gt;failure(([{&quot;error&quot;: &quot;Connection failed&quot;}]));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sock-&gt;write(&quot;GET / HTTP/1.0\r\nHost: &quot; + host + &quot;\r\n\r\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string response = sock-&gt;read();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sock-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        result-&gt;success(response);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return result-&gt;future();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Use the future</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Concurrent.Future f = async_http_get(&quot;example.com&quot;, 80);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    f-&gt;on_success(lambda(string response) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;Got response of %d bytes\n&quot;, sizeof(response));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    f-&gt;on_failure(lambda(mapping err) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Request failed: %s\n&quot;, err-&gt;error);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Wait for completion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mixed result = f-&gt;wait();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-forking-servers">Pre-Forking Servers<a href="#pre-forking-servers" class="hash-link" aria-label="Direct link to Pre-Forking Servers" title="Direct link to Pre-Forking Servers" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Connection Pool (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Thread.Mutex)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ConnectionPool {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private string host;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private int port;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private array(Stdio.File) connections = (({}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private int max_size;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private Thread.Mutex lock = Thread.Mutex();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    void create(string _host, int _port, int _max_size)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        host = _host;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        port = _port;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        max_size = _max_size;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File acquire()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mixed key = lock-&gt;lock();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Stdio.File sock;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (sizeof(connections)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sock = connections[0];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            connections = connections[1..];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sock = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if (!sock-&gt;connect(host, port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                lock-&gt;unlock();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock-&gt;unlock();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return sock;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    void release(Stdio.File sock)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        mixed key = lock-&gt;lock();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (sizeof(connections) &lt; max_size) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            connections += (({sock}));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            sock-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        lock-&gt;unlock();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="non-forking-servers">Non-Forking Servers<a href="#non-forking-servers" class="hash-link" aria-label="Direct link to Non-Forking Servers" title="Direct link to Non-Forking Servers" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Incomplete. There&#x27;s multiple ways to do this, including:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//1) Threaded server (works like forking but clients can share global state if desired)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//2) Multiplexing using select()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//3) Callback mode (puts the sockets under the control of a Backend which uses select())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="writing-a-multi-homed-server">Writing a Multi-Homed Server<a href="#writing-a-multi-homed-server" class="hash-link" aria-label="Direct link to Writing a Multi-Homed Server" title="Direct link to Writing a Multi-Homed Server" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Stdio.Port mainsock=Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if (!mainsock-&gt;bind(server_port))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    werror(&quot;Couldn&#x27;t be a tcp server on port %d: %s\n&quot;,server_port,strerror(mainsock-&gt;errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while (1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File sock=mainsock-&gt;accept();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!sock) break;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string localaddr=sock-&gt;query_address(1); //Is the IP address and port connected to.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //The IP will be that of one of your interfaces, and the port should be equal to server_port</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="making-a-daemon-server">Making a Daemon Server<a href="#making-a-daemon-server" class="hash-link" aria-label="Direct link to Making a Daemon Server" title="Direct link to Making a Daemon Server" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if (!System.chroot(&quot;/var/daemon&quot;)) werror(&quot;Unable to chroot to /var/daemon: %s\n&quot;,strerror(errno()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//Incomplete (I don&#x27;t fork in Pike). See predef::fork() and Process.create_process() for details.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="restarting-a-server-on-demand">Restarting a Server on Demand<a href="#restarting-a-server-on-demand" class="hash-link" aria-label="Direct link to Restarting a Server on Demand" title="Direct link to Restarting a Server on Demand" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//The best way to restart the server is to adopt a microkernel concept and restart only the parts of</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//the server that need updating. However, if you must reload, see Process.exec()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="program-backsniff">Program: backsniff<a href="#program-backsniff" class="hash-link" aria-label="Direct link to Program: backsniff" title="Direct link to Program: backsniff" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// backsniff - Simple port scanner detector (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.Port)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int port = argc &gt; 1 ? (int)argv[1] : 8080;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.Port listen = Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!listen-&gt;bind(port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Bind failed\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;backsniff listening on port %d\n&quot;, port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Stdio.File sock = listen-&gt;accept();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!sock) continue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        string remote = sock-&gt;query_address();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        write(&quot;Connection from: %s at %s\n&quot;, remote, ctime(time()));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Log and close</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sock-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="program-fwdport">Program: fwdport<a href="#program-fwdport" class="hash-link" aria-label="Direct link to Program: fwdport" title="Direct link to Program: fwdport" translate="no">​</a></h2>
<div class="language-pike codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-pike codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// fwdport - TCP port forwarder (Pike 8)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#pragma strict_types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.Port)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#require constant(Stdio.File)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">void forward_data(Stdio.File client, Stdio.File target)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string data = client-&gt;read(8192, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (data &amp;&amp; sizeof(data)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        target-&gt;write(data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        data = client-&gt;read(8192, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    target-&gt;close(&quot;w&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">void handle_client(Stdio.File client, string target_host, int target_port)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.File target = Stdio.File();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!target-&gt;connect(target_host, target_port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Failed to connect to target\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        client-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Create threads for bidirectional forwarding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.Thread t1 = Thread.Thread(forward_data, client, target);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Thread.Thread t2 = Thread.Thread(forward_data, target, client);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t1-&gt;wait();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t2-&gt;wait();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    client-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    target-&gt;close();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">int main(int argc, array(string) argv)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (argc &lt; 4) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Usage: %s listen_port target_host target_port\n&quot;, argv[0]);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int listen_port = (int)argv[1];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string target_host = argv[2];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    int target_port = (int)argv[3];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Stdio.Port listen = Stdio.Port();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (!listen-&gt;bind(listen_port)) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        werror(&quot;Bind failed on port %d\n&quot;, listen_port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    write(&quot;Forwarding %d -&gt; %s:%d\n&quot;, listen_port, target_host, target_port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Stdio.File client = listen-&gt;accept();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (!client) continue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        //Handle client in thread</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Thread.Thread(handle_client, client, target_host, target_port);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">//-----------------------------</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/smuks/pike-cookbook/tree/main/docs/network/sockets.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pike-cookbook/docs/network/cgi-programming"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CGI Programming</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pike-cookbook/docs/network/web-automation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Web Automation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#writing-a-tcp-client" class="table-of-contents__link toc-highlight">Writing a TCP Client</a></li><li><a href="#writing-a-tcp-server" class="table-of-contents__link toc-highlight">Writing a TCP Server</a></li><li><a href="#communicating-over-tcp" class="table-of-contents__link toc-highlight">Communicating over TCP</a></li><li><a href="#setting-up-a-udp-client" class="table-of-contents__link toc-highlight">Setting Up a UDP Client</a></li><li><a href="#setting-up-a-udp-server" class="table-of-contents__link toc-highlight">Setting Up a UDP Server</a></li><li><a href="#using-unix-domain-sockets" class="table-of-contents__link toc-highlight">Using UNIX Domain Sockets</a></li><li><a href="#unix-domain-socket-server" class="table-of-contents__link toc-highlight">UNIX Domain Socket Server</a></li><li><a href="#identifying-the-other-end-of-a-socket" class="table-of-contents__link toc-highlight">Identifying the Other End of a Socket</a></li><li><a href="#finding-your-own-name-and-address" class="table-of-contents__link toc-highlight">Finding Your Own Name and Address</a></li><li><a href="#ssltls-sockets" class="table-of-contents__link toc-highlight">SSL/TLS Sockets</a></li><li><a href="#ssltls-server" class="table-of-contents__link toc-highlight">SSL/TLS Server</a></li><li><a href="#closing-a-socket-after-forking" class="table-of-contents__link toc-highlight">Closing a Socket After Forking</a></li><li><a href="#writing-bidirectional-clients" class="table-of-contents__link toc-highlight">Writing Bidirectional Clients</a></li><li><a href="#non-blocking-io-with-select" class="table-of-contents__link toc-highlight">Non-Blocking I/O with select()</a></li><li><a href="#forking-servers" class="table-of-contents__link toc-highlight">Forking Servers</a></li><li><a href="#socket-options-and-configuration" class="table-of-contents__link toc-highlight">Socket Options and Configuration</a></li><li><a href="#modern-async-with-concurrentfuture" class="table-of-contents__link toc-highlight">Modern Async with Concurrent.Future</a></li><li><a href="#pre-forking-servers" class="table-of-contents__link toc-highlight">Pre-Forking Servers</a></li><li><a href="#non-forking-servers" class="table-of-contents__link toc-highlight">Non-Forking Servers</a></li><li><a href="#writing-a-multi-homed-server" class="table-of-contents__link toc-highlight">Writing a Multi-Homed Server</a></li><li><a href="#making-a-daemon-server" class="table-of-contents__link toc-highlight">Making a Daemon Server</a></li><li><a href="#restarting-a-server-on-demand" class="table-of-contents__link toc-highlight">Restarting a Server on Demand</a></li><li><a href="#program-backsniff" class="table-of-contents__link toc-highlight">Program: backsniff</a></li><li><a href="#program-fwdport" class="table-of-contents__link toc-highlight">Program: fwdport</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/pike-cookbook/docs/intro">Cookbook</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/smuks/pike-cookbook" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://pike.lysator.liu.se/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pike Homepage<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>