"use strict";(self.webpackChunkpike_cookbook=self.webpackChunkpike_cookbook||[]).push([[330],{664(e,n,a){a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>c,frontMatter:()=>i,metadata:()=>t,toc:()=>m});const t=JSON.parse('{"id":"basics/dates","title":"Dates and Times","description":"Introduction","source":"@site/docs/basics/dates.md","sourceDirName":"basics","slug":"/basics/dates","permalink":"/pike-cookbook/docs/basics/dates","draft":false,"unlisted":false,"editUrl":"https://github.com/smuks/pike-cookbook/tree/main/docs/basics/dates.md","tags":[],"version":"current","frontMatter":{"id":"dates","title":"Dates and Times","sidebar_label":"Dates and Times"},"sidebar":"tutorialSidebar","previous":{"title":"Hashes","permalink":"/pike-cookbook/docs/basics/hashes"},"next":{"title":"Pattern Matching","permalink":"/pike-cookbook/docs/basics/pattern-matching"}}');var o=a(4848),r=a(8453);const i={id:"dates",title:"Dates and Times",sidebar_label:"Dates and Times"},d=void 0,s={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Finding Today&#39;s Date",id:"finding-todays-date",level:2},{value:"Converting DMYHMS to Epoch Seconds",id:"converting-dmyhms-to-epoch-seconds",level:2},{value:"Converting Epoch Seconds to DMYHMS",id:"converting-epoch-seconds-to-dmyhms",level:2},{value:"Adding to or Subtracting from a Date",id:"adding-to-or-subtracting-from-a-date",level:2},{value:"Difference of Two Dates",id:"difference-of-two-dates",level:2},{value:"Day in a Week/Month/Year or Week Number",id:"day-in-a-weekmonthyear-or-week-number",level:2},{value:"Parsing Dates and Times from Strings",id:"parsing-dates-and-times-from-strings",level:2},{value:"Printing a Date",id:"printing-a-date",level:2},{value:"High-Resolution Timers",id:"high-resolution-timers",level:2},{value:"Short Sleeps",id:"short-sleeps",level:2},{value:"Program: hopdelta",id:"program-hopdelta",level:2}];function l(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(n.p,{children:"Pike has an extensive Calendar module that provides all manners of manipulating dates and times."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'// Pike has an extensive Calendar module that provides all manners of\n// manipulating dates and times.\nwrite("Today is day %d of the current year.\\n", localtime(time())->yday+1);\n// Today is day 325 of the current year.\n\nwrite("Today is day %d of the current year.\\n", Calendar.now()->year_day());\n// Today is day 325 of the current year.\n'})}),"\n",(0,o.jsx)(n.h2,{id:"finding-todays-date",children:"Finding Today's Date"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'int day, month, year;\nmapping now=localtime(time());\nyear  = now->year+1900;\nmonth = now->mon+1;\nday   = now->mday;\n\nwrite("The current date is %04d %02d %02d\\n", year, month, day);\n\nobject now=Calendar.now();\nyear  = now->year_no();\nmonth = now->month_no();\nday   = now->month_day();\n\nwrite("The current date is %04d %02d %02d\\n", year, month, day);\n\nwrite("The current date is %04d %02d %02d\\n", @lambda(){ return ({ now->year_no(), now->month_no(), now->month_day() }); }(Calendar.now()));\n// this is essentially the same as the respective perl code:\n// lambda creates an anonymous function, which in this case takes one argument\n// and returns an array. the array is the spliced into the arguments of write().\n// if the goal is to get by without a temporary variable this is a rather\n// pointless exercise, as there is still a temporary variable (in the function)\n// and the temporary function on top of that. more interresting is the\n// functional approach aspect.\n'})}),"\n",(0,o.jsx)(n.h2,{id:"converting-dmyhms-to-epoch-seconds",children:"Converting DMYHMS to Epoch Seconds"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'// dwim_time() handles most common date and time formats.\nCalendar.dwim_time("2:40:25 23.11.2004");\n// Result: Second(Tue 23 Nov 2004 2:40:25 CET)\nCalendar.dwim_time("2:40:25 23.11.2004")->unix_time();\n// Result: 1101174025\n\nCalendar.dwim_time("2:40:25 UTC 23.11.2004");\n// Result: Second(Tue 23 Nov 2004 2:40:25 UTC)\n\n// faster, because there is no need for guessing:\nCalendar.parse("%Y-%M-%D %h:%m:%s %z","2004-11-23 2:40:25 UTC");\n// Result: Second(Tue 23 Nov 2004 2:40:25 UTC)\n\n// without parsing\nCalendar.Second(2004, 11, 23, 2, 40, 25);\n// Result: Second(Tue 23 Nov 2004 2:40:25 CET)\n\n// functional\nCalendar.Year(2004)->month(11)->day(23)->hour(2)->minute(40)->second(25);\n// Result: Second(Tue 23 Nov 2004 2:40:25 CET)\n\nCalendar.Day(2004, 11, 23)->set_timezone("UTC")->hour(2)->minute(40)->second(25);\n// Result: Second(Tue 23 Nov 2004 2:40:25 UTC)\n\n// set a time today\nCalendar.dwim_time("2:40:25");\n// Result: Second(Tue 23 Nov 2004 2:40:25 CET)\nCalendar.dwim_time("2:40:25 UTC");\n// Result: Second(Tue 23 Nov 2004 2:40:25 UTC)\n\nCalendar.parse("%h:%m:%s %z","2:40:25 UTC");\n// Result: Second(Tue 23 Nov 2004 2:40:25 UTC)\nCalendar.Day()->set_timezone("UTC")->hour(2)->minute(40)->second(25);\n// Result: Second(Tue 23 Nov 2004 2:40:25 UTC)\n'})}),"\n",(0,o.jsx)(n.h2,{id:"converting-epoch-seconds-to-dmyhms",children:"Converting Epoch Seconds to DMYHMS"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'int unixtime=1101174025;\nint day, month, year;\nmapping then=localtime(unixtime);\nyear  = then->year+1900;\nmonth = then->mon+1;\nday   = then->mday;\n\nwrite("Dateline: %02d:%02d:%02d-%04d/%02d/%02d\\n", then->hour, then->min, then->sec, then->year+1900, then->mon+1, then->mday);\n// Dateline: 02:40:25-2004/11/23\n\nobject othen=Calendar.Second(unixtime);\n// Result: Second(Tue 23 Nov 2004 2:40:25 CET)\n\nwrite("Dateline: %02d:%02d:%02d-%04d/%02d/%02d\\n", othen->hour_no(),\n      othen->minute_no(), othen->second_no(), othen->year_no(),\n      othen->month_no(), othen->month_day());\n// Dateline: 02:40:25-2004/11/23\n'})}),"\n",(0,o.jsx)(n.h2,{id:"adding-to-or-subtracting-from-a-date",children:"Adding to or Subtracting from a Date"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'int days_offet=55;\nint hour_offset=2;\nint minute_offset=17;\nint second_offset=5;\n\nobject then=Calendar.parse("%D/%M/%Y, %h:%m:%s %p","18/Jan/1973, 3:45:50 pm")\n            +Calendar.Day()*days_offet\n            +Calendar.Hour()*hour_offset\n            +Calendar.Minute()*minute_offset\n            +Calendar.Second()*second_offset;\nwrite("Then is %s\\n", then->format_ctime());\n// Then is Wed Mar 14 18:02:55 1973\nwrite("To be precise: %d:%d:%d, %d/%d/%d\\n",\n             then->hour_no(), then->minute_no(), then->second_no(),\n             then->month_no(), then->month_day(), then->year_no());\n// To be precise: 18:2:55, 3/14/1973\n\nint years   = 1973;\nint months  = 1;\nint days    = 18;\nint offset  = 55;\nobject then = Calendar.Day(years, months, days)+offset;\nwrite("Nat was 55 days old on: %d/%d/%d\\n", then->month_no(), then->month_day(),then->year_no());\n// Nat was 55 days old on: 3/14/1973\n'})}),"\n",(0,o.jsx)(n.h2,{id:"difference-of-two-dates",children:"Difference of Two Dates"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'int bree = 361535725;         // 16 Jun 1981, 4:35:25\nint nat  = 96201950;          // 18 Jan 1973, 3:45:50\n\nint difference = bree-nat;\nwrite("There were %d seconds between Nat and Bree\\n", difference);\n// There were 265333775 seconds between Nat and Bree\n\nint seconds =  difference                % 60;\nint minutes = (difference / 60)          % 60;\nint hours   = (difference / (60*60) )    % 24;\nint days    = (difference / (60*60*24) ) % 7;\nint weeks   =  difference / (60*60*24*7);\n\nwrite("(%d weeks, %d days, %d:%d:%d)\\n", weeks, days, hours, minutes, seconds);\n// (438 weeks, 4 days, 23:49:35)\n\nobject bree = Calendar.dwim_time("16 Jun 1981, 4:35:25");\n// Result: Second(Tue 16 Jun 1981 4:35:25 CEST)\nobject nat  = Calendar.dwim_time("18 Jan 1973, 3:45:50");\n// Result: Second(Thu 18 Jan 1973 3:45:50 CET)\nobject difference = nat->range(bree);\n// Result: Second(Thu 18 Jan 1973 3:45:50 CET - Tue 16 Jun 1981 4:35:26 CEST)\n\nwrite("There were %d days between Nat and Bree\\n", difference/Calendar.Day());\n// There were 3071 days between Nat and Bree\n\nint days=difference/Calendar.Day();\nobject left=difference->add(days,Calendar.Day)->range(difference->end());\n\n// Calendar handles timezone differences, and since the range crosses from\n// normal to daylight savings time, there is one day which has only 23 hours.\n// by adding the number of days we effectively move the beginning of the range\n// to the same day as the end, leaving us with a range that is less than a day\n// long. when adding the days, the daylight savings switch will be taken into\n// account.\n\nwrite("Bree came %d days, %d:%d:%d after Nat\\n",\n                   days,\n                   (left/Calendar.Hour())%24,\n                   (left/Calendar.Minute())%60,\n                   (left/Calendar.Second())%60,\n                   );\n\n// Bree came 3071 days, 0:49:36 after Nat\n\n// the following is more accurate, taking into account that the days where\n// daylight savings time is switched do not have 24, but 23 and 25 hours.\n// thanks to mirar on the pike list for pointing this out and providing a\n// correct solution.\n\narray(int) breakdown_elapsed(object u, void|array on)\n{\n  array res=({});\n  if (!on) on=({Day,Hour,Minute,Second});\n  foreach (on;;program|TimeRange p)\n  {\n    if (u==u->end()) { res+=({0}); continue; }\n    int x=u/p;\n    u=u->add(x,p)->range(u->end());\n    res+=({x});\n  }\n  return res;\n}\n\nwrite("Bree came %d days, %d:%d:%d after Nat\\n",\n      @breakdown_elapsed(difference));\n\n// Bree came 3071 days, 0:49:36 after Nat\n'})}),"\n",(0,o.jsx)(n.h2,{id:"day-in-a-weekmonthyear-or-week-number",children:"Day in a Week/Month/Year or Week Number"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'mapping day=localtime(time());\nday->mday;\n// Result: 2\nday->wday;\n// Result: 4\nday->yday;\n// Result: 336\n\nint year=1981;\nint month=6;\nint day=16;\nobject date;\ndate = Calendar.Day(year, month, day);\n// Result: Day(Tue 16 Jun 1981)\n\ndate->week_day();\n// Result: 3\ndate->week_no();\n// Result: 24\ndate->year_day();\n// Result: 167\nwrite("%d/%d/%d was a %s\\n", month, day, year, date->week_day_name());\n// 6/16/1981 was a Tuesday\n\nwrite("in the week number %d.\\n", date->week_no());\n// in the week number 25.\n'})}),"\n",(0,o.jsx)(n.h2,{id:"parsing-dates-and-times-from-strings",children:"Parsing Dates and Times from Strings"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'string date = "1998-06-03";\nint yyyy;\nint mm;\nint dd;\n[yyyy, mm, dd] = array_sscanf(date, "%d-%d-%d");\n\nobject day;\nday=Calendar.dwim_day(date);\nday=Calendar.parse("%Y-%M-%D", date);\n\nday->unix_time();\n// Result: 896824800\nday->year_no();\n// Result: 1998\nday->month_no();\n// Result: 6\nday->month_day();\n// Result: 3\n'})}),"\n",(0,o.jsx)(n.h2,{id:"printing-a-date",children:"Printing a Date"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'object now=Calendar.dwim_time("Sun Sep 21 15:33:36 1997");\n// Result: Second(Sun 21 Sep 1997 15:33:36 CEST)\n\nnow->format_ctime();\n// Result: "Sun Sep 21 15:33:36 1997\\n"\n\n// there is no equivalent to scalar localtime\n\nnow = Calendar.Second(1973, 1, 18, 3, 45, 50);\nwrite("strftime gives: %s %02d/%02d/%!2d\\n", now->week_day_name(),\n        now->month_no(), now->month_day(), now->year_no());\n// strftime gives: Sunday 01/18/73\n// pike doesn\'t have strftime, but hey.\n\n// instead Calendar provides a large array of predefined formats:\n\n// format_nice() and format_nicez() depend on the unit:\nnow->format_nice();           // "18 Jan 1973 3:45:50"\nnow->week()->format_nice();   // "w3 1973"\nnow->format_nicez();          // "18 Jan 1973 3:45:50 CET"\nnow->hour()->format_nicez();  // "18 Jan 1973 3:00 CET"\n\n// others are unit independant.\nnow->format_ext_time();       // "Thursday, 18 January 1973 03:45:50"\nnow->format_ext_ymd();        // "Thursday, 18 January 1973"\nnow->format_iso_time();       // "1973-01-18 (Jan) -W03-4 (Thu) 03:45:50 UTC+1"\nnow->format_iso_ymd();        // "1973-01-18 (Jan) -W03-4 (Thu)"\nnow->format_mod();            // "03:45"\nnow->format_month();          // "1973-01"\nnow->format_month_short();    // "197301"\nnow->format_mtime();          // "1973-01-18 03:45"\nnow->format_time();           // "1973-01-18 03:45:50"\nnow->format_time_short();     // "19730118 03:45:50"\nnow->format_time_xshort();    // "730118 03:45:50"\nnow->format_tod();            // "03:45:50"\nnow->format_tod_short();      // "034550"\nnow->format_todz();           // "03:45:50 CET"\nnow->format_todz_iso();       // "03:45:50 UTC+1"\nnow->format_week();           // "1973-w3"\nnow->format_week_short();     // "1973w3"\nnow->format_iso_week();       // "1973-W03"\nnow->format_iso_week_short(); // "197303"\nnow->format_xtime();          // "1973-01-18 03:45:50.000000"\nnow->format_xtod();           // "03:45:50.000000"\nnow->format_ymd();            // "1973-01-18"\nnow->format_ymd_short();      // "19730118"\nnow->format_ymd_xshort();     // "730118"\n\nnow->format_ctime();          // "Thu Jan 18 03:45:50 1973\\n"\nnow->format_smtp();           // "Thu, 18 Jan 1973 3:45:50 +0100"\nnow->format_http();           // "Thu, 18 Jan 1973 02:45:50 GMT"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"high-resolution-timers",children:"High-Resolution Timers"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'int t=time();                 // current time in unixtime seconds\nfloat t0=time(t);             // higher precision time passed since t\nfloat t1=time(t);\nfloat elapsed=t1-t0;\n// Result: 0.009453\n\n//-------------------------------------------\nwrite("Press return when ready: ");\narray(int) before=System.gettimeofday();\nStdio.stdin->gets();\narray(int) after=System.gettimeofday();\nint elapsed_sec=after[0]-before[0];\nint elapsed_usec=after[1]-before[1];\nif(elapsed_usec<0)\n{\n  elapsed_sec--;\n  elapsed_usec+=1000000;\n}\n\nwrite("You took %d.%d seconds.\\n", elapsed_sec, elapsed_usec);\n//-------------------------------------\n// this is an expanded example compared to the one given for perl\n// to allow comparison of different types.\n// bignum are objects of the gmp library, which are seamlessly integrated with\n// regular integers.\n\nint main()\n{\n  // size values are adjusted so that each run takes about the same length.\n  gaugethis(5000000, 100, lambda(){ return random(pow(2,31)-1); });\n               // values to fit into a signed 32bit int.\n  gaugethis(50000, 100, lambda(){ return pow(2,64)+random(pow(2,64)); });\n               // make sure values are bignum even in case 64bit ints are used.\n  gaugethis(500000, 100, lambda(){ return random_string(10); });\n               // might be interresting to compare longer strings too.\n}\n\nvoid gaugethis(int size, int number_of_times, function rand)\n{\n  array gauged_times = ({});\n  float average;\n\n  int swidth=sizeof((string)size);\n  int nwidth=sizeof((string)number_of_times);\n  for(int i; i<number_of_times; i++)\n  {\n    write("%*d: ", nwidth, i);\n    array(int) arr=({});\n    write("creating array: ");\n    for(int j; j<size; j++)\n    {\n      arr += ({ rand() });\n    }\n    write(" sorting: ");\n\n    float gaugetime=gauge // gauge measures cpu time, giving better results\n    {\n      arr=sort(arr);\n    };\n    gauged_times += ({ gaugetime });\n    write(" %f          \\r", gaugetime);\n  }\n  average=`+(@gauged_times)/(float)number_of_times;\n  gauged_times=sort(gauged_times);\n\n  write("average: %O, min: %O, max: %O                           \\n",\n        average, gauged_times[0], gauged_times[-1]);\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"short-sleeps",children:"Short Sleeps"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:"int abort_on_signal=1;         // if true, aport on signal\nsleep(0.25, abort_on_signal);\n\ndelay(0.25); // uses busy-wait for accuracy,\n             // may be interrupted by signal handlers\n"})}),"\n",(0,o.jsx)(n.h2,{id:"program-hopdelta",children:"Program: hopdelta"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-pike",children:'Calendar.dwim_time("Tue, 26 May 1998 23:57:38 -0400")->distance(\n    Calendar.dwim_time("Wed, 27 May 1998 05:04:03 +0100"))->format_elapsed();\n// Result: "0:06:25"\n\n// <font size="-1"><a href="../include/pike/ch03/hopdelta.html">download the following standalone program</a></font>\n#!/usr/bin/pike\n// chapter 3.11\n// hopdelta - feed mail header, produce lines\n//            showing delay at each hop.\nint main()\n{\n  MIME.Message        mail = MIME.Message(Stdio.stdin.read());\n\n  array           received = reverse(mail->headers->received/"\\0");\n  Calendar.Second lasttime = Calendar.dwim_time(mail->headers->date);\n\n  array delays=({ ({ "Sender", "Recipient", "Time", "Delta" }) });\n  delays+=({ ({ mail->headers->from,\n                array_sscanf(received[0], "from %[^ ]")[0],\n                mail->headers->date,\n                ""\n          }) });\n\n\n  foreach(received;; string hop)\n  {\n    string fromby, date;\n    [fromby, date] = hop/";";\n    Calendar.Second thistime = Calendar.dwim_time(date);\n\n    delays+= ({ array_sscanf(fromby, "from %[^ ]%*sby %[^ ]%*s") +\n                ({ date, lasttime->distance(thistime)->format_elapsed() })\n             });\n\n    lasttime=thistime;\n  }\n\n  write("%{%-=22s %-=22s %-=20s %=10s\\n%}\\n", delays);\n  return 0;\n}\n'})})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453(e,n,a){a.d(n,{R:()=>i,x:()=>d});var t=a(6540);const o={},r=t.createContext(o);function i(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);