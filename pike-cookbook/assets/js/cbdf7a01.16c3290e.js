"use strict";(self.webpackChunkpike_cookbook=self.webpackChunkpike_cookbook||[]).push([[107],{8453(n,e,i){i.d(e,{R:()=>a,x:()=>o});var r=i(6540);const s={},t=r.createContext(s);function a(n){const e=r.useContext(t);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),r.createElement(t.Provider,{value:e},n.children)}},9036(n,e,i){i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"advanced/processes","title":"Process Management","description":"Gathering Output from a Program","source":"@site/docs/advanced/processes.md","sourceDirName":"advanced","slug":"/advanced/processes","permalink":"/pike-cookbook/docs/advanced/processes","draft":false,"unlisted":false,"editUrl":"https://github.com/smuks/pike-cookbook/tree/main/docs/advanced/processes.md","tags":[],"version":"current","frontMatter":{"id":"processes","title":"Process Management","sidebar_label":"Process Management"},"sidebar":"tutorialSidebar","previous":{"title":"Modules and Packages","permalink":"/pike-cookbook/docs/advanced/modules"},"next":{"title":"User Interfaces","permalink":"/pike-cookbook/docs/advanced/user-interfaces"}}');var s=i(4848),t=i(8453);const a={id:"processes",title:"Process Management",sidebar_label:"Process Management"},o="Process Management and Communication",l={},c=[{value:"Gathering Output from a Program",id:"gathering-output-from-a-program",level:2},{value:"Running Another Program",id:"running-another-program",level:2},{value:"Replacing the Current Program with a Different One",id:"replacing-the-current-program-with-a-different-one",level:2},{value:"Reading or Writing to Another Program",id:"reading-or-writing-to-another-program",level:2},{value:"Filtering Your Own Output",id:"filtering-your-own-output",level:2},{value:"Preprocessing Input",id:"preprocessing-input",level:2},{value:"Reading STDERR from a Program",id:"reading-stderr-from-a-program",level:2},{value:"Controlling Input and Output of Another Program",id:"controlling-input-and-output-of-another-program",level:2},{value:"Controlling the Input, Output, and Error of Another Program",id:"controlling-the-input-output-and-error-of-another-program",level:2},{value:"Communicating Between Related Processes",id:"communicating-between-related-processes",level:2},{value:"Making a Process Look Like a File with Named Pipes",id:"making-a-process-look-like-a-file-with-named-pipes",level:2},{value:"Sharing Variables in Different Processes",id:"sharing-variables-in-different-processes",level:2},{value:"Listing Available Signals",id:"listing-available-signals",level:2},{value:"Sending a Signal",id:"sending-a-signal",level:2},{value:"Installing a Signal Handler",id:"installing-a-signal-handler",level:2},{value:"Temporarily Overriding a Signal Handler",id:"temporarily-overriding-a-signal-handler",level:2},{value:"Writing a Signal Handler",id:"writing-a-signal-handler",level:2},{value:"Catching Ctrl-C",id:"catching-ctrl-c",level:2},{value:"Avoiding Zombie Processes",id:"avoiding-zombie-processes",level:2},{value:"Blocking Signals",id:"blocking-signals",level:2},{value:"Timing Out an Operation",id:"timing-out-an-operation",level:2},{value:"Program: sigrand",id:"program-sigrand",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"process-management-and-communication",children:"Process Management and Communication"})}),"\n",(0,s.jsx)(e.h2,{id:"gathering-output-from-a-program",children:"Gathering Output from a Program"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Gather output using Process.run (Pike 8 modern API)\n#pragma strict_types\n\n#include <process.h>\n\nmapping result = Process.run(({"ls", "-l", "/tmp"}));\n\nwrite("Exit code: %d\\n", result->exitcode);\nwrite("Output:\\n%s\\n", result->stdout);\nwrite("Errors:\\n%s\\n", result->stderr);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"running-another-program",children:"Running Another Program"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Run a command using Process.create_process (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\n// Method 1: Create and wait\nProcess.create_process proc = Process.create_process(({"echo", "Hello"}));\nint exit_code = proc->wait();\nwrite("Exit code: %d\\n", exit_code);\n\n// Method 2: Use Process.Process with callbacks\nProcess.Process p = Process.Process(({"sleep", "5"}}), ([\n    "timeout": 10,\n    "timeout_callback": lambda(Process.Process proc) {\n        write("Process timed out!\\n");\n    }\n]));\n\np->wait();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"replacing-the-current-program-with-a-different-one",children:"Replacing the Current Program with a Different One"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Replace current process using Process.exec (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\n#if constant(exece)\n// Exec replaces the current process image\nProcess.exec("/bin/ls", "-l", "/tmp");\n\n// This line is never reached if exec succeeds\nwerror("Exec failed: %s\\n", strerror(errno()));\n#else\nwrite("exec not available on this system\\n");\n#endif\n'})}),"\n",(0,s.jsx)(e.h2,{id:"reading-or-writing-to-another-program",children:"Reading or Writing to Another Program"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Bidirectional communication with a process (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\n// Create pipes for stdin/stdout\nStdio.File stdin_pipe = Stdio.File();\nStdio.File stdout_pipe = Stdio.File();\n\nProcess.create_process proc = Process.create_process(\n    ({"cat", "-n"}),\n    ([\n        "stdin": stdin_pipe->pipe(Stdio.PROP_IPC | Stdio.PROP_REVERSE),\n        "stdout": stdout_pipe->pipe()\n    ])\n);\n\n// Close unused ends\nstdin_pipe->close();\n\n// Write to process\nstdin_pipe->write("Line 1\\nLine 2\\nLine 3\\n");\nstdin_pipe->close();\n\n// Read response\nstdout_pipe->close();\nstring output = stdout_pipe->read();\nwrite("Output:\\n%s", output);\n\nproc->wait();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"filtering-your-own-output",children:"Filtering Your Own Output"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Filter output through external processes (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nstring text = "zebra\\napple\\nbanana\\napple\\ncherry\\n";\n\n// Sort the output\nmapping sorted = Process.run(\n    ({"sort"}),\n    (["stdin": text])\n);\n\n// Get unique lines\nmapping unique = Process.run(\n    ({"uniq"}),\n    (["stdin": sorted->stdout])\n);\n\nwrite("After sort | uniq:\\n%s", unique->stdout);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"preprocessing-input",children:"Preprocessing Input"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Preprocess input through awk (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nstring data = "alice:30\\nbob:25\\ncharlie:35\\n";\n\nmapping result = Process.run(\n    ({"awk", "-F:", "{print $1, $2}"}),\n    (["stdin": data])\n);\n\nwrite("Processed output:\\n%s", result->stdout);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"reading-stderr-from-a-program",children:"Reading STDERR from a Program"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Capture stderr separately (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nmapping result = Process.run((\n    "ls", "/nonexistent"\n));\n\nwrite("Exit code: %d\\n", result->exitcode);\nwrite("STDERR:\\n%s\\n", result->stderr);\n\n// Manual pipe handling for stderr\nStdio.File stderr_pipe = Stdio.File();\n\nProcess.create_process proc = Process.create_process(\n    ({"ls", "/nonexistent"}),\n    (["stderr": stderr_pipe->pipe()])\n);\n\nstderr_pipe->close();\nstring errors = stderr_pipe->read();\nwrite("Errors: %s\\n", errors);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"controlling-input-and-output-of-another-program",children:"Controlling Input and Output of Another Program"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Full control of stdin, stdout, stderr (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nStdio.File stdin_p = Stdio.File();\nStdio.File stdout_p = Stdio.File();\nStdio.File stderr_p = Stdio.File();\n\nProcess.create_process proc = Process.create_process(\n    ({"cat", "-n"}),\n    ([\n        "stdin": stdin_p->pipe(Stdio.PROP_IPC | Stdio.PROP_REVERSE),\n        "stdout": stdout_p->pipe(),\n        "stderr": stderr_p->pipe()\n    ])\n);\n\n// Write to stdin\nstdin_p->write("test data\\n");\nstdin_p->close();\n\n// Read stdout and stderr\nstdout_p->close();\nstderr_p->close();\n\nstring out = stdout_p->read();\nstring err = stderr_p->read();\n\nproc->wait();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"controlling-the-input-output-and-error-of-another-program",children:"Controlling the Input, Output, and Error of Another Program"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Using Process.run for simple cases (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nmapping result = Process.run(\n    ({"awk", "{print $1}"}),\n    ([\n        "stdin": "apple:1\\nbanana:2\\n",\n        "cwd": "/tmp"\n    ])\n);\n\nwrite("Output: %s", result->stdout);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"communicating-between-related-processes",children:"Communicating Between Related Processes"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Parent-child communication via pipes (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nStdio.File parent_rd = Stdio.File();\nStdio.File parent_wr = Stdio.File();\nStdio.File child_rd = Stdio.File();\nStdio.File child_wr = Stdio.File();\n\nProcess.create_process child = Process.create_process(\n    ({"cat", "-e"}),\n    ([\n        "stdin": child_rd->pipe(Stdio.PROP_IPC | Stdio.PROP_REVERSE),\n        "stdout": child_wr->pipe()\n    ])\n);\n\nchild_rd->close();\nchild_wr->close();\n\n// Send data to child\nparent_wr->write("Message from parent\\n");\nparent_wr->close();\n\n// Read response\nparent_rd->close();\nstring response = parent_rd->read();\nwrite("Child response:\\n%s", response);\n\nchild->wait();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"making-a-process-look-like-a-file-with-named-pipes",children:"Making a Process Look Like a File with Named Pipes"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Named pipes (FIFOs) for IPC (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nstring fifo_path = "/tmp/pike_fifo";\n\n// Create FIFO\nProcess.create_process mkfifo = Process.create_process(({"mkfifo", fifo_path}));\nmkfifo->wait();\n\n// Writer process\nProcess.create_process writer = Process.create_process(\n    ({"sh", "-c", "echo \'Hello through FIFO\' > " + fifo_path})\n);\n\n// Reader process\nmapping result = Process.run(({"cat", fifo_path}));\nwrite("FIFO data: %s", result->stdout);\n\nwriter->wait();\n\n// Cleanup\nProcess.create_process({"rm", "-f", fifo_path})->wait();\n'})}),"\n",(0,s.jsx)(e.h2,{id:"sharing-variables-in-different-processes",children:"Sharing Variables in Different Processes"}),"\n",(0,s.jsx)(e.p,{children:"For sharing variables between processes, use files, shared memory, or implement a message passing system. Here's a file-based approach:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Shared state via file (Pike 8)\n#pragma strict_types\n\nstring state_file = "/tmp/pike_shared_state.txt";\n\n// Writer process\nmapping state = ([\n    "counter": 42,\n    "timestamp": time()\n]);\n\nStdio.write_file(state_file, encode_value(state));\n\n// Reader process\nstring data = Stdio.read_file(state_file);\nmapping loaded_state = mixederr = catch {\n    return decode_value(data);\n};\n\nif (loaded_state) {\n    write("Counter: %d\\n", loaded_state->counter);\n    write("Timestamp: %s\\n", ctime(loaded_state->timestamp));\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"listing-available-signals",children:"Listing Available Signals"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// List available signals (Pike 8)\n#pragma strict_types\n\narray(string) signals = ({\n    "SIGHUP", "SIGINT", "SIGQUIT", "SIGILL", "SIGTRAP",\n    "SIGABRT", "SIGBUS", "SIGFPE", "SIGKILL", "SIGUSR1",\n    "SIGSEGV", "SIGUSR2", "SIGPIPE", "SIGALRM", "SIGTERM",\n    "SIGCHLD", "SIGCONT", "SIGSTOP", "SIGTSTP"\n});\n\nwrite("Available signals:\\n");\nforeach(signals; int i; string sig) {\n    int num = signum(sig);\n    if (num > 0) {\n        write("  %2d: %s\\n", num, sig);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"sending-a-signal",children:"Sending a Signal"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Send signal to process (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\n#if constant(kill)\n// Create a long-running process\nProcess.create_process proc = Process.create_process(({"sleep", "30"}));\nint pid = proc->pid();\n\n// Wait a bit, then send SIGTERM\nsleep(2);\nproc->kill(signum("SIGTERM"));\n\n// Wait for process to exit\nint exit_code = proc->wait();\nwrite("Process exited with code: %d\\n", exit_code);\n#else\nwrite("kill() not available on this system\\n");\n#endif\n'})}),"\n",(0,s.jsx)(e.h2,{id:"installing-a-signal-handler",children:"Installing a Signal Handler"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Signal handlers for graceful shutdown (Pike 8)\n#pragma strict_types\n\nvolatile int shutdown_requested = 0;\n\nvoid handle_sigint() {\n    write("\\n[INFO] SIGINT received. Shutting down...\\n");\n    shutdown_requested = 1;\n}\n\n#if constant(signal)\nsignal(signum("SIGINT"), handle_sigint);\nsignal(signum("SIGTERM"), handle_sigint);\n#endif\n\nwhile (!shutdown_requested) {\n    write("Working...\\n");\n    sleep(1);\n}\n\nwrite("Cleanup complete.\\n");\n'})}),"\n",(0,s.jsx)(e.h2,{id:"temporarily-overriding-a-signal-handler",children:"Temporarily Overriding a Signal Handler"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Save and restore signal handler (Pike 8)\n#pragma strict_types\n\n#if constant(signal)\n// Save current handler\nfunction old_handler = signal(signum("SIGINT"), 0);\n\n// Install temporary handler\nvoid temp_handler() {\n    write("Temporary handler\\n");\n}\n\nsignal(signum("SIGINT"), temp_handler);\n\n// Do work...\n\n// Restore original handler\nsignal(signum("SIGINT"), old_handler);\n#endif\n'})}),"\n",(0,s.jsx)(e.h2,{id:"writing-a-signal-handler",children:"Writing a Signal Handler"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Comprehensive signal handler (Pike 8)\n#pragma strict_types\n\n#if constant(signal)\nvolatile int signal_count = 0;\n\nvoid signal_handler() {\n    signal_count++;\n    write("Signal received (count: %d)\\n", signal_count);\n}\n\nvoid cleanup() {\n    write("Performing cleanup...\\n");\n    // Close files, save state, etc.\n}\n\n// Install handlers\nsignal(signum("SIGTERM"), signal_handler);\nsignal(signum("SIGINT"), signal_handler);\n\n// Main loop\nwhile (signal_count < 3) {\n    sleep(1);\n}\n\ncleanup();\n#endif\n'})}),"\n",(0,s.jsx)(e.h2,{id:"catching-ctrl-c",children:"Catching Ctrl-C"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Catch Ctrl+C (SIGINT) (Pike 8)\n#pragma strict_types\n\n#if constant(signal)\nvolatile int interrupted = 0;\n\nvoid handle_interrupt() {\n    interrupted++;\n    if (interrupted == 1) {\n        write("\\nPress Ctrl+C again to force exit.\\n");\n    } else {\n        write("\\nForced exit!\\n");\n        exit(1);\n    }\n}\n\nsignal(signum("SIGINT"), handle_interrupt);\n\nwrite("Running... Press Ctrl+C to interrupt.\\n");\n\nwhile (!interrupted) {\n    write(".\\n");\n    sleep(1);\n}\n\nwrite("Graceful shutdown complete.\\n");\n#endif\n'})}),"\n",(0,s.jsx)(e.h2,{id:"avoiding-zombie-processes",children:"Avoiding Zombie Processes"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Proper child reaping to avoid zombies (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\narray(Process.create_process) children = ({});\n\n// Spawn multiple children\nfor (int i = 0; i < 3; i++) {\n    Process.create_process proc = Process.create_process(({\n        "sleep", sprintf("%d", (i + 1) * 2)\n    }));\n    children += ({ proc });\n}\n\n// Wait for all children (reap zombies)\nforeach(children; int i; Process.create_process proc) {\n    int exit_code = proc->wait();\n    write("Child %d exited with code: %d\\n", i + 1, exit_code);\n}\n\nwrite("All children reaped. No zombies!\\n");\n'})}),"\n",(0,s.jsx)(e.h2,{id:"blocking-signals",children:"Blocking Signals"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Signal blocking for critical sections (Pike 8)\n#pragma strict_types\n\n#if constant(sigprocmask)\n// Block signals during critical operation\nint signal_block(int sig, int block) {\n    return sigprocmask(sig, block);\n}\n\n// Block SIGINT during critical section\nsignal_block(signum("SIGINT"), 1);\nwrite("Critical section - signals blocked\\n");\n// Do critical work...\n\n// Unblock signals\nsignal_block(signum("SIGINT"), 0);\nwrite("Signals unblocked\\n");\n#else\nwrite("sigprocmask not available\\n");\n#endif\n'})}),"\n",(0,s.jsx)(e.h2,{id:"timing-out-an-operation",children:"Timing Out an Operation"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Process timeout with callback (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nProcess.Process proc = Process.Process(\n    ({"sleep", "30"}),\n    ([\n        "timeout": 2,\n        "timeout_callback": lambda(Process.Process p) {\n            write("\\n[TIMEOUT] Process exceeded time limit!\\n");\n        }\n    ])\n);\n\nwrite("Process started with 2 second timeout...\\n");\nint exit_code = proc->wait();\nwrite("Exit code: %d\\n", exit_code);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"program-sigrand",children:"Program: sigrand"}),"\n",(0,s.jsx)(e.p,{children:"A simple daemon that generates random numbers and responds to signals:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-pike",children:'// Signal-handling daemon example (Pike 8)\n#pragma strict_types\n\n#include <process.h>\n\nvolatile int running = 1;\nvolatile int count = 0;\n\nvoid sigterm_handler() {\n    write("\\n[SIGTERM] Shutting down...\\n");\n    running = 0;\n}\n\n#if constant(signal)\nsignal(signum("SIGTERM"), sigterm_handler);\nsignal(signum("SIGINT"), sigterm_handler);\n#endif\n\n// Daemonize\nProcess.daemon(0, 0);\n\nStdio.File log = Stdio.File("/tmp/sigrand.log", "wac");\n\nwhile (running) {\n    int rand_num = random(100);\n    log->write(sprintf("[%s] Random: %d\\n", ctime(time()), rand_num));\n    count++;\n    sleep(1);\n}\n\nlog->write(sprintf("Total iterations: %d\\n", count));\nlog->close();\n'})})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(d,{...n})}):d(n)}}}]);